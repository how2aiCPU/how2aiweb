<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PScolor_3D.glb — Three.js Viewer (Classic)</title>
  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#111}
    #error{position:fixed;left:12px;top:12px;right:12px;padding:12px;border-radius:8px;
           background:#2b1b1b;color:#ffdada;font:13px/1.4 system-ui,Arial;display:none;white-space:pre-wrap}
  </style>
</head>
<body>
<div id="error"></div>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>
<script>
(function(){
  const errBox = document.getElementById('error');
  function showError(msg){ errBox.style.display='block'; errBox.textContent='Ошибка: '+msg; console.error(msg); }
  window.addEventListener('error', e => showError(e.message));
  window.addEventListener('unhandledrejection', e => showError(String(e.reason?.message || e.reason || e)));

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.01, 2000);
  camera.position.set(0,1,3);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const dir = new THREE.DirectionalLight(0xffffff, 1.2);
  dir.position.set(3,5,2);
  scene.add(dir);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.5;

  const loader = new THREE.GLTFLoader();
  loader.load('./PScolor_3D.glb', function(gltf){
    scene.add(gltf.scene);
    fit(camera, gltf.scene, controls);
  }, undefined, function(err){ showError('Не удалось загрузить GLB: '+(err.message||err)); });

  function fit(cam, obj, controls){
    const box = new THREE.Box3().setFromObject(obj);
    const size = box.getSize(new THREE.Vector3());
    const center = box.getCenter(new THREE.Vector3());
    const maxSize = Math.max(size.x,size.y,size.z) || 1;
    const dist = maxSize / (2*Math.tan(THREE.MathUtils.degToRad(cam.fov)/2));
    cam.position.copy(center).add(new THREE.Vector3(dist, dist*0.3, dist));
    cam.near = dist/100; cam.far = dist*100; cam.updateProjectionMatrix();
    controls.target.copy(center); controls.update();
  }

  (function animate(){
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  })();

  window.addEventListener('resize', function(){
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
})();
</script>
</body>
</html>
