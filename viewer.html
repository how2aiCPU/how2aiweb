<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer (ESM)</title>
  <style>html,body{height:100%;margin:0;background:#111;overflow:hidden}canvas{display:block;width:100%;height:100%}
  #msg{position:fixed;left:12px;top:12px;right:12px;padding:10px;border-radius:10px;background:#2b2b2b;color:#eee;font:13px/1.45 system-ui,Arial}</style>
</head>
<body>
<div id="msg">Загружается…</div>
<script type="module">
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js';
  import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/loaders/GLTFLoader.js';
  import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/controls/OrbitControls.js';

  const banner = document.getElementById('msg');
  function set(t){ banner.textContent=t; }

  const scene = new THREE.Scene(); scene.background = new THREE.Color(0x202225);
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.01, 2000);
  const renderer = new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth, innerHeight);
  renderer.outputColorSpace = THREE.SRGBColorSpace; renderer.toneMapping = THREE.ACESFilmicToneMapping;
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff,0.6));
  const d = new THREE.DirectionalLight(0xffffff,1.0); d.position.set(3,5,2); scene.add(d);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.autoRotate = true; camera.position.set(0,1,3);

  new GLTFLoader().load('./PScolor_3D.glb', (g)=>{
    scene.add(g.scene); fit(camera,g.scene,controls); set('Готово'); setTimeout(()=>banner.remove(),1000);
  }, e=>{ if(e.total) set('Загрузка '+(e.loaded/e.total*100).toFixed(0)+'%'); },
  err=>{ set('Ошибка: ' + (err.message||err)); });

  function fit(cam,obj,ctrl){ const b=new THREE.Box3().setFromObject(obj), c=b.getCenter(new THREE.Vector3()),
    s=b.getSize(new THREE.Vector3()), m=Math.max(s.x,s.y,s.z)||1, dist=m/(2*Math.tan(THREE.MathUtils.degToRad(cam.fov)/2));
    cam.near=dist/100; cam.far=dist*100; cam.updateProjectionMatrix(); cam.position.copy(c).add(new THREE.Vector3(dist,dist*0.3,dist));
    ctrl.target.copy(c); ctrl.update(); }

  (function loop(){ requestAnimationFrame(loop); controls.update(); renderer.render(scene,camera); })();
  addEventListener('resize',()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });
</script>
</body>
</html>
